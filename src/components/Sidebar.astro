---
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const tags = posts.flatMap(post => post.data.tags || []);
const tagCounts = tags.reduce((acc, tag) => {
    acc[tag] = (acc[tag] || 0) + 1;
    return acc;
}, {} as Record<string, number>);
const uniqueTags = Object.keys(tagCounts).sort();

interface Props {
    activeTag?: string;
}

const { activeTag } = Astro.props;
---

<aside class="w-full lg:w-64 flex-shrink-0 animate-fade-in-up delay-100 order-1">
    <div class="lg:sticky lg:top-24 bg-white/50 backdrop-blur-xl rounded-2xl p-6 border border-gray-100 shadow-sm">
        <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tags"><path d="m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19"/><path d="M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 1 3.56 3.56l-5-5A2 2 0 0 0 6 16.172V11a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 22.29a2.426 2.426 0 0 0 3.56-3.56"/><path d="m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19"/><path d="M7 7h.01"/></svg>
            Tags
        </h2>
        <div class="flex flex-wrap lg:flex-col gap-2">
            <a href="/blog" class={`group flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${!activeTag ? 'bg-blue-50 text-blue-700' : 'text-gray-600 hover:bg-gray-50 hover:text-blue-600'}`}>
                <span>All Posts</span>
                <span class={`py-0.5 px-2 rounded-full text-xs transition-colors duration-200 ${!activeTag ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-500 group-hover:bg-blue-50 group-hover:text-blue-600'}`}>{posts.length}</span>
            </a>
            {uniqueTags.map(tag => (
                <a href={`/tags/${tag}`} class={`group flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 ${activeTag === tag ? 'bg-blue-50 text-blue-700' : 'text-gray-600 hover:bg-gray-50 hover:text-blue-600'}`}>
                    <span>#{tag}</span>
                    <span class={`py-0.5 px-2 rounded-full text-xs transition-colors duration-200 ${activeTag === tag ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-500 group-hover:bg-blue-50 group-hover:text-blue-600'}`}>{tagCounts[tag]}</span>
                </a>
            ))}
        </div>
    </div>
</aside>